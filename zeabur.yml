services:
  postgresql:
    type: postgresql

  app:
    type: python
    build:
      # ä½¿ç”¨åˆ†å±¤å®‰è£ç­–ç•¥ï¼Œå„ªåŒ–ç·©å­˜æ•ˆç‡
      command: |
        echo "ğŸš€ é–‹å§‹åˆ†å±¤æ§‹å»º..."
        pip install --upgrade pip
        
        echo "ğŸ“¦ å®‰è£æ ¸å¿ƒä¾è³´ï¼ˆå¿«é€Ÿï¼‰..."
        pip install -r requirements.core.txt
        
        echo "ğŸ§  å®‰è£æ©Ÿå™¨å­¸ç¿’ä¾è³´ï¼ˆç·©å­˜å‹å¥½ï¼‰..."
        pip install -r requirements.ml.txt
        
        echo "âœ… æ§‹å»ºå®Œæˆï¼"
    start:
      command: gunicorn --bind 0.0.0.0:$PORT --timeout 300 --workers 1 --max-requests 1000 --preload start_simple:app
    env:
      PORT: 5000
      FLASK_ENV: production
      TZ: Asia/Taipei
      SECRET_KEY: your-secret-key-here
      DATABASE_URL: ${POSTGRES_CONNECTION_STRING}
      OPENAI_API_KEY: your-openai-api-key-here
      CRON_SECRET_TOKEN: your-cron-secret-token-here
      # Google OAuth è¨­å®š
      GOOGLE_CLIENT_ID: your-google-client-id-here
      GOOGLE_CLIENT_SECRET: your-google-client-secret-here
      # Email é€šçŸ¥è¨­å®š (å¯é¸)
      SMTP_SERVER: smtp.gmail.com
      SMTP_PORT: 587
      SMTP_USERNAME: your-email@gmail.com
      SMTP_PASSWORD: your-app-password
      FROM_EMAIL: your-email@gmail.com
      FROM_NAME: BGG è¨­è¨ˆå¸«è¿½è¹¤
    dependencies:
      - postgresql
    healthcheck:
      endpoint: /health
      interval: 120s
      timeout: 60s
      retries: 10
      start_period: 300s
    volumes:
      - name: reports
        mount: /app/frontend/public/outputs

volumes:
  reports: