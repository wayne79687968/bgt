{% extends "base.html" %}

{% block title %}ç™»å…¥ - BGG ç†±é–€éŠæˆ²å ±è¡¨{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-4">
        <div class="card mt-5">
            <div class="card-header text-center">
                <h4>ğŸ² BGG ç¶œåˆåˆ†æå¹³å°</h4>
                <p class="text-muted">è«‹ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥</p>
            </div>
            <div class="card-body text-center">
                <div id="g_id_onload"
                     data-client_id="{{ google_client_id }}"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin" 
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="sign_in_with"
                     data-shape="rectangular"
                     data-logo_alignment="left">
                </div>
                
                <div class="mt-4">
                    <small class="text-muted">
                        ç™»å…¥å¾Œå¯ä½¿ç”¨ï¼š<br>
                        â€¢ ğŸ“Š ç†±é–€éŠæˆ²å ±è¡¨æª¢è¦–<br>
                        â€¢ ğŸ¯ å€‹äººåŒ–éŠæˆ²æ¨è–¦<br>
                        <span class="text-warning">â€¢ ğŸ¨ è¨­è¨ˆå¸«è¿½è¹¤ (åƒ…é™ç®¡ç†å“¡)</span>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
function handleCredentialResponse(response) {
    // è™•ç† Google ç™»å…¥å›æ‡‰
    const credential = response.credential;
    
    // é¡¯ç¤ºè¼‰å…¥ä¸­
    document.querySelector('.card-body').innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">è¼‰å…¥ä¸­...</span></div><p class="mt-2">é©—è­‰ä¸­...</p></div>';
    
    // ç™¼é€åˆ°å¾Œç«¯é©—è­‰
    fetch('/auth/google?token=' + encodeURIComponent(credential))
        .then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            } else {
                return response.text();
            }
        })
        .then(data => {
            if (data) {
                // å¦‚æœæœ‰éŒ¯èª¤è¨Šæ¯ï¼Œé¡¯ç¤ºå®ƒ
                document.body.innerHTML = data;
            }
        })
        .catch(error => {
            console.error('ç™»å…¥å¤±æ•—:', error);
            alert('ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦');
            location.reload();
        });
}

// åˆå§‹åŒ– Google Sign-In
window.onload = function() {
    // Google Identity Services æœƒè‡ªå‹•è¼‰å…¥
}
</script>
{% endblock %}